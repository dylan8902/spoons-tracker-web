<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<dom-module id="spoons-tracker-tracker">
  <template>
    <style>
       :host {
        display: block;
      }
    </style>

    <firebase-auth user="{{user}}" provider="facebook"></firebase-auth>
    <firebase-query path="/users/[[user.uid]]/visited" data="{{visits}}" query="shallow=true"></firebase-query>

    <div style="padding:16px">
      <p>You've visited [[visits.length]] wetherspoons, please find a list below:</p>
      <ul>
        <template is="dom-repeat" items="{{visits}}" as="visit">
          <li>[[_decode(visit.$key)]]</li>
        </template>
      </ul>
    </div>

  </template>
  <script>
    Polymer({
      is: 'spoons-tracker-tracker',

      properties: {
        visits: {
          type: Array,
          value: []
        }
      },

      _decode: function (text) {
        return decodeURIComponent(text).replace(/\+/g, ' ');
      }
    });
  </script>
</dom-module>